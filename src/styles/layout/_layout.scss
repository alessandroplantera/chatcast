// layout/_layout.scss - 3-column adaptive layout (left / center / right)

@use '../abstracts/variables' as *;

/* Local design constants (no custom Sass functions used) */
:root {
	--border-color: rgba(255,255,255,0.12);
	--hover-bg: rgba(255,255,255,0.04);
}

.main-layout {
	height: 100vh;
	background-color: var(--bg-black);
	display: flex;
	font-size: var(--base);
	flex-direction: row;
}

/* Grid container controlling columns visibility */
.layout {
	--layout-left-width: 100%;
	--layout-right-width: auto;
	display: grid;
	height: 100%;
	width: 100%;
	grid-auto-rows: 100%;
	gap: 0;
	transition: grid-template-columns .35s ease;
	/* Default: only left column visible should be full width */
	grid-template-columns: 1fr;
}

/* Only left visible */
.layout.is-center-collapsed.is-right-collapsed {
	/* Only left visible: take 100% */
	grid-template-columns: 1fr;
}
/* Left + Right (no center) */
.layout.is-center-collapsed:not(.is-right-collapsed) {
	/* Left + Right (no center): left remains fluid, right fixed */
	grid-template-columns: 1fr var(--layout-right-width);
}
/* Left + Center */
.layout:not(.is-center-collapsed).is-right-collapsed {
	/* Left + Center: left becomes sidebar width, center fills */
	grid-template-columns: var(--layout-left-width) 1fr;
}
/* All three visible */
.layout:not(.is-center-collapsed):not(.is-right-collapsed) {
	grid-template-columns: var(--layout-left-width) 1fr var(--layout-right-width);
}

/* Right column collapsed: remove from flow but keep tab visible */
.layout.is-right-collapsed .layout__col--right {
	position: fixed;
	right: 0;
	top: 0;
	bottom: 0;
	width: 0;
	min-width: 0;
	border: none;
	background: transparent;
	overflow: visible;
	pointer-events: none;
}
.layout.is-right-collapsed .layout__col--right .sidebar-tab {
	pointer-events: auto;
}

.layout__col {
	min-width: 0;
	width: 100%;
	overflow: hidden;
	position: relative;
	display: flex;
	flex-direction: column;
	background: var(--bg-black);
}
.layout__col:last-child { border-right: none; }


.layout__col--center {
	background-color: var(--bg-light);
	opacity: 0;
	transition: opacity .25s ease;
}
.layout__col--center[hidden] { display: none !important; }
.layout__col--center:not([hidden]) { opacity: 1; }
.layout__col--center .message-thread { flex: 1; overflow-y: auto; padding: .75rem 1rem; }

.thread-header {
	padding: .75rem 1rem;
	border-bottom: 1px solid var(--border-color);
	display: flex;
	flex-direction: column;
	justify-content: space-between;
	align-items: flex-start;
	gap: var(--spacing-sm);
	background-color: var(--bg-black);
}

#thread-header-content,
.thread-header-content {
	flex: 1;
	background-color: var(--bg-black);
	padding:0;
	pointer-events: none;
	.conversation-list__header-title {
		color: var(--text-body-light);
		.user__guest {
			color: var(--chat-entity-guest);
		}
	}
	.conversation-list__meta * {
		color: var(--text-body-light);
	}

}
/* Sidebar (right column) */
.sidebar {
	background: var(--bg-black);
	display: flex;
	flex-direction: column;
	position: relative;
}
.sidebar.is-collapsed {
	/* Remove from layout flow completely; only show the floating tab */
	position: fixed;
	right: -1px;
	top: 0;
	bottom: 0;
	width: 0;
	border-left: none;
	background: transparent;
	pointer-events: none;
}
.sidebar.is-collapsed .sidebar-tab {
	pointer-events: auto;
}
.sidebar:not(.is-collapsed) { position: relative; }

.sidebar__panel {
	/* When visible, shown via [hidden] toggle; animate slide-in */
	display: flex;
	flex-direction: column;
	height: 100%;
	will-change: transform, opacity;
}
.sidebar__panel[hidden] { display: none !important; }
.sidebar__panel:not([hidden]) { animation: sidebarSlide .28s ease; }

.sidebar__header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: .75rem 1rem;
	border-bottom: 1px solid var(--border-color);
}

.sidebar__title {
	margin: 0;
	font-size: var(--sm);
	font-weight: var(--font-weight-regular);
	color: var(--text-body-light);
	letter-spacing: .05em;
}

.sidebar__content { flex: 1; overflow-y: auto; padding: var(--xs); }

@keyframes sidebarSlide { from { opacity: 0; transform: translateX(12px); } to { opacity: 1; transform: translateX(0); } }

/* Vertical tab when collapsed */
.sidebar-tab {
	position: fixed;
	right: 0;
	top: 50%;
	transform: translateY(-50%) translateX(35%) rotate(-90deg);
	transform-origin: center;
	background: var(--bg-black);
	color: var(--text-body-light);
	border: 1px solid var(--bg-dark);
	border-bottom: none;
	font-size: var(--lg);
	font-weight: var(--font-weight-regular);
	letter-spacing: .05em;
	cursor: pointer;
	transition: background .2s ease;
}

/* Hide icon and close button on desktop (only show label) */
.sidebar-tab__icon,
.sidebar-tab__close {
	display: none;
}

/* Hide the tab when the panel is open */
.sidebar:not(.is-collapsed) .sidebar-tab { display: none; }

.icon-btn {
	background: transparent;
	color: var(--text-body-light);
	cursor: pointer;
	font: inherit;
	transition: background .15s ease, border-color .15s ease;
}

/* ===========================================
   MOBILE STYLES (max-width: 768px)
   =========================================== */
@media (max-width: 768px) {
	/* Layout: single column, no grid complexity */
	.layout {
		display: flex;
		flex-direction: column;
		position: relative;
	}
	
	/* Reset all grid-based states for mobile */
	.layout.is-center-collapsed.is-right-collapsed,
	.layout.is-center-collapsed:not(.is-right-collapsed),
	.layout:not(.is-center-collapsed).is-right-collapsed,
	.layout:not(.is-center-collapsed):not(.is-right-collapsed) {
		grid-template-columns: unset;
	}
	
	/* Left column: full screen, leave space for bottom bar */
	.layout__col--left {
		flex: 1;
		padding-bottom: var(--3xl); /* Space for bottom bar */
		overflow-y: auto;
	}
	
	/* Center column: overlay on mobile */
	.layout__col--center {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: var(--3xl); /* Leave space for bottom bar */
		z-index: 100;
		background-color: var(--bg-light);
		transform: translateY(100%);
		transition: transform .35s ease, opacity .25s ease;
	}
	.layout__col--center[hidden] {
		display: flex !important;
		transform: translateY(100%);
		opacity: 0;
		pointer-events: none;
	}
	.layout__col--center:not([hidden]) {
		transform: translateY(0);
		opacity: 1;
		pointer-events: auto;
	}
	
	/* Right column (sidebar): becomes bottom bar */
	.layout__col--right,
	.sidebar {
		position: fixed !important;
		left: 0;
		right: 0;
		bottom: 0;
		top: auto !important;
		width: 100% !important;
		height: auto;
		max-height: 85vh;
		z-index: 200;
		border-top: 1px solid var(--border-color);
		border-left: none;
		border-right: none;
		background: var(--bg-black);
		overflow: visible;
		pointer-events: auto !important;
	}
	
	/* Collapsed sidebar on mobile: just the bottom tab bar */
	.layout.is-right-collapsed .layout__col--right,
	.sidebar.is-collapsed {
		height: var(--3xl);
		max-height: var(--3xl);
		overflow: hidden;
	}
	
	/* Expanded sidebar on mobile: slides up */
	.layout:not(.is-right-collapsed) .layout__col--right,
	.sidebar:not(.is-collapsed) {
		height: 95vh;
		max-height: 100vh;
	}
	
	/* Bottom bar tab (replaces vertical sidebar tab) */
	.sidebar-tab {
		position: relative;
		right: auto;
		top: auto;
		transform: none;
		width: 100%;
		height: var(--3xl);
		display: flex;
		align-items: center;
		justify-content: space-between;
		padding: 0 1rem;
		background: var(--bg-black);
		border: none;
		border-top: 1px solid var(--border-color);
		font-size: var(--base);
	}
	
	/* Arrow icon in tab */
	.sidebar-tab__arrow {
		width: 1rem;
		height: 1rem;
		transition: transform .25s ease;
	}
	
	/* Hide close button when collapsed, show arrow */
	.sidebar.is-collapsed .sidebar-tab__close {
		display: none;
	}
	.sidebar.is-collapsed .sidebar-tab__icon {
		display: flex;
	}
	
	/* Show close button when expanded, hide arrow */
	.sidebar:not(.is-collapsed) .sidebar-tab__close {
		display: block;
	}
	.sidebar:not(.is-collapsed) .sidebar-tab__icon {
		display: none;
	}
	
	/* Show tab even when panel is open on mobile */
	.sidebar:not(.is-collapsed) .sidebar-tab {
		display: flex;
		border-bottom: 1px solid var(--border-color);
	}
	
	/* Panel slides up from bottom */
	.sidebar__panel {
		max-height: calc(100vh - var(--3xl));
		overflow-y: auto;
	}
	.sidebar__panel[hidden] {
		display: none !important;
	}
	
	/* Hide desktop sidebar header on mobile (use tab instead) */
	.sidebar__header {
		display: none;
	}
	
	/* Animation for mobile bottom sheet */
	@keyframes bottomSheetSlide {
		from { 
			opacity: 0; 
			transform: translateY(20px); 
		}
		to { 
			opacity: 1; 
			transform: translateY(0); 
		}
	}
	
	.sidebar__panel:not([hidden]) {
		animation: bottomSheetSlide .28s ease;
	}
}
