// layout/_layout.scss - 3-column adaptive layout (left / center / right)

@use '../abstracts/variables' as *;

/* Local design constants (no custom Sass functions used) */
:root {
	--border-color: rgba(255, 255, 255, 0.12);
	--hover-bg: rgba(255, 255, 255, 0.04);
}

/* Upcoming Chat Banner */
.upcoming-chat-banner {
	color: var(--text-body-light);
	padding: calc(var(--base) / 4) calc(var(--base) / 2);
	display: flex;
	flex-direction: column;
	gap: 0.25rem;
}

.upcoming-chat-banner__date {
	margin: 0;
	font-size: var(--2xl);
	color: var(--text-body-light);
}

.upcoming-chat-banner__participants {
	margin: 0;
	font-size: var(--2xl);
	color: var(--text-body-light);
}

.upcoming-chat-banner__topic {
	margin: 0;
	font-size: var(--3xl);
	font-weight: var(--font-weight-regular);
	color: var(--text-body-light);
}

.main-layout {
	height: 100vh;
	height: 100dvh; /* Dynamic viewport height - fixes Safari mobile */
	/* Fallback for older Safari */
	@supports (-webkit-touch-callout: none) {
		height: -webkit-fill-available;
	}
	background-color: var(--bg-black);
	display: flex;
	font-size: var(--base);
	flex-direction: row;
}

/* Grid container controlling columns visibility */
.layout {
	--layout-left-width: 100%;
	--layout-right-width: auto;
	display: grid;
	height: 100%;
	width: 100%;
	grid-auto-rows: 100%;
	gap: 0;
	transition: grid-template-columns .35s ease;
	/* Default: only left column visible should be full width */
	grid-template-columns: 1fr;
}

/* Only left visible */
.layout.is-center-collapsed.is-right-collapsed {
	/* Only left visible: take 100% */
	grid-template-columns: 1fr;
}

/* Left + Right (no center) */
.layout.is-center-collapsed:not(.is-right-collapsed) {
	/* Left + Right (no center): left remains fluid, right fixed */
	grid-template-columns: 1fr var(--layout-right-width);
}

/* Left + Center */
.layout:not(.is-center-collapsed).is-right-collapsed {
	/* Left + Center: left becomes sidebar width, center fills */
	grid-template-columns: var(--layout-left-width) 1fr;
}

/* All three visible */
.layout:not(.is-center-collapsed):not(.is-right-collapsed) {
	grid-template-columns: var(--layout-left-width) 1fr var(--layout-right-width);
	min-width: 33%;
}

/* Right column collapsed: remove from flow but keep tab visible */
.layout.is-right-collapsed .layout__col--right {
	position: fixed;
	right: 0;
	top: 0;
	bottom: 0;
	width: 0;
	min-width: 0;
	border: none;
	background: transparent;
	overflow: visible;
	pointer-events: none;
}

.layout.is-right-collapsed .layout__col--right .sidebar-tab {
	pointer-events: auto;
}

.layout__col {
	min-width: 0;
	width: 100%;
	overflow: hidden;
	position: relative;
	display: flex;
	flex-direction: column;
	background: var(--bg-black);
}

.layout__col:last-child {
	border-right: none;
}


.layout__col--center {
	background-color: var(--bg-light);
	opacity: 0;
	transition: opacity .25s ease;
}

.layout__col--center[hidden] {
	display: none !important;
}

.layout__col--center:not([hidden]) {
	opacity: 1;
	min-width: 35%;
}

.layout__col--center .message-thread {
	flex: 1;
	overflow-y: auto;
	padding: .75rem 1rem;
}

.thread-header {
	padding: .75rem 1rem;
	border-bottom: 1px solid var(--border-color);
	display: flex;
	flex-direction: column;
	justify-content: space-between;
	align-items: flex-start;
	gap: var(--spacing-xl);
	background-color: var(--bg-black);
}

#thread-header-content,
.thread-header-content {
	flex: 1;
	background-color: var(--bg-black);
	padding: 0;

	.conversation-list__header-title {
		color: var(--text-body-light);

		.user-badge,
		.js-guest-name {
			cursor: pointer;
			pointer-events: auto;
		}

		.user__guest {
			color: var(--chat-entity-guest);
		}
	}

	.conversation-list__meta * {
		color: var(--text-body-light);
	}

}

/* Sidebar (right column) */
.sidebar {
	background: var(--bg-black);
	display: flex;
	flex-direction: column;
	position: relative;
}

.sidebar.is-collapsed {
	/* Remove from layout flow completely; only show the floating tabs */
	position: fixed;
	right: -1px;
	top: 0;
	bottom: 0;
	width: 0;
	border-left: none;
	background: transparent;
	pointer-events: none;
}

.sidebar.is-collapsed .sidebar-tab {
	pointer-events: auto;
	padding-inline: 0.21rem;
}

.sidebar:not(.is-collapsed) {
	position: relative;
	width: 60%;
}

.sidebar__panel {
	/* When visible, shown via [hidden] toggle; animate slide-in */
	display: flex;
	flex-direction: column;
	height: 100%;
	width: 100%;
	will-change: transform, opacity;
}

.sidebar__panel[hidden] {
	display: none !important;
}

.sidebar__panel:not([hidden]) {
	animation: sidebarSlide .28s ease;
}

/* Panel header (for separate panels) */
.sidebar__panel-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	background: var(--bg-black);
	padding: 0.25rem 0.4rem;
	min-height: fit-content;
}

.sidebar__panel-title {
	margin: 0;
	font-size: var(--sm);
	font-weight: var(--font-weight-regular);
	color: var(--text-body-light);
	letter-spacing: .05em;
	line-height: 1;
}

/* Sidebar Tabs */
.sidebar__tabs {
	display: flex;
	align-items: stretch;
	border-bottom: 1px solid var(--border-color);
	background: var(--bg-black);
	min-height: 0.5rem;
	max-height: 1.5rem;
}

.sidebar__tab {
	display: flex;
	align-items: center;
	justify-content: space-between;
	gap: clamp(0.1rem, 0.3rem, 0.5rem);
	padding: var(--spacing-sm) var(--spacing-sm);
	background: transparent;
	border: none;
	color: var(--text-body-light);
	font-size: var(--sm);
	font-weight: var(--font-weight-regular);
	letter-spacing: .05em;
	cursor: pointer;
	transition: background .2s ease;
	flex: 1;
	/* Default: take available space */
}

/* When tabs container has .has-guest, tabs get min-width and compete for space */
.sidebar__tabs.has-guest .sidebar__tab {
	flex: 0 0 auto;
	min-width: 30%;
	text-transform: uppercase;
	white-space: nowrap;
}

/* ABOUT tab fixed at 30% when guest is present */
.sidebar__tabs.has-guest .sidebar__tab.js-tab-about {
	min-width: clamp(20%, 30%, 40%);
	max-width: 40%;
}

.js-tab-guest {
	width: 70%;
	max-width: 70%;
	color: var(--text-body-light);
}

.sidebar__tab:hover {
	background: var(--hover-bg);
	color: var(--text-body-light);
}

/* Active state only applies when there are multiple tabs */
.sidebar__tabs.has-guest .sidebar__tab.is-active {
	background: var(--bg-light);
	color: var(--text-body-dark);

}

.sidebar__tab[hidden] {
	display: none;
}

.sidebar__tab-title.is-active {
	color: var(--text-body-dark);
}

.sidebar__tab-close {
	font-size: var(--xs);
	opacity: 0.6;
	transition: opacity .15s ease;
}

.sidebar__tab-close:hover {
	opacity: 1;
}

.sidebar__close {
	margin-left: auto;
}

/* Tab content areas */
.sidebar__tab-content {
	display: none;
	flex-direction: column;
	flex: 1;
	overflow: hidden;
	padding: var(--xs);
}

.sidebar__tab-content.is-active {
	display: flex;
}

.sidebar__header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: .75rem 1rem;
	border-bottom: 1px solid var(--border-color);
}

.sidebar__title {
	margin: 0;
	font-size: var(--sm);
	font-weight: var(--font-weight-regular);
	color: var(--text-body-light);
	letter-spacing: .05em;
}

.sidebar__content {
	flex: 1;
	overflow-y: auto;
	padding-bottom: 10vh;
}

@keyframes sidebarSlide {
	from {
		opacity: 0;
		transform: translateX(12px);
	}

	to {
		opacity: 1;
		transform: translateX(0);
	}
}

/* Tabs when collapsed - horizontal in bottom right */
.sidebar-tab {
	position: fixed;
	right: 1rem;
	bottom: 1rem;
	transform: none;
	background: var(--bg-black);
	color: var(--text-body-light);
	font-size: var(--base);
	font-weight: var(--font-weight-regular);
	letter-spacing: .05em;
	cursor: pointer;
	transition: background .2s ease;
	padding: 0rem 0.25rem;
}

/* Position About tab - always in bottom right */
.sidebar-tab--about {
	right: 0;
	bottom: 0;
}

/* Position Guest tab - to the left of About when visible */
.sidebar-tab--guest {
	bottom: 1rem;
	/* Calculate position: 1rem (about right margin) + about width + gap */
	right: calc(1rem + 12rem + 0.5rem);
}

.sidebar-tab--guest[hidden] {
	display: none;
}

/* Hide icon and close button on desktop (only show label) */
.sidebar-tab__icon,
.sidebar-tab__close {
	display: none;
}

/* Hide the tabs when the panel is open */
.sidebar:not(.is-collapsed) .sidebar-tab {
	display: none;
}

.icon-btn {
	background: transparent;
	color: var(--text-body-light);
	line-height: 0 !important; 
	cursor: pointer;
	font: inherit;
	transition: background .15s ease, border-color .15s ease;
}

/* ===========================================
   MOBILE STYLES (max-width: 768px)
   =========================================== */
@media (max-width: 768px) {

	/* Layout: single column, no grid complexity */
	.layout {
		display: flex;
		flex-direction: column;
		position: relative;
	}

	/* Reset all grid-based states for mobile */
	.layout.is-center-collapsed.is-right-collapsed,
	.layout.is-center-collapsed:not(.is-right-collapsed),
	.layout:not(.is-center-collapsed).is-right-collapsed,
	.layout:not(.is-center-collapsed):not(.is-right-collapsed) {
		grid-template-columns: unset;
	}

	/* Left column: full screen, leave space for bottom bar */
	.layout__col--left {
		flex: 1;
		padding-bottom: var(--3xl);
		/* Space for bottom bar */
		overflow-y: auto;
	}

	/* Center column: overlay on mobile */
	.layout__col--center {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: var(--3xl);
		/* Leave space for bottom bar */
		z-index: 100;
		background-color: var(--bg-light);
		transform: translateY(100%);
		transition: transform .35s ease, opacity .25s ease;
	}

	.layout__col--center[hidden] {
		display: flex !important;
		transform: translateY(100%);
		opacity: 0;
		pointer-events: none;
	}

	.layout__col--center:not([hidden]) {
		transform: translateY(0);
		opacity: 1;
		pointer-events: auto;
	}

	/* Right column (sidebar): becomes bottom bar */
	.layout__col--right,
	.sidebar {
		position: fixed !important;
		left: 0;
		right: 0;
		bottom: 0;
		top: auto !important;
		width: 100% !important;
		height: auto;
		max-height: 85vh;
		max-height: 85dvh;
		z-index: 200;
		border-top: 1px solid var(--border-color);
		border-left: none;
		border-right: none;
		background: var(--bg-black);
		overflow: visible;
		pointer-events: auto !important;
	}

	/* Collapsed sidebar on mobile: just the bottom tab bar */
	.layout.is-right-collapsed .layout__col--right,
	.sidebar.is-collapsed {
		height: var(--3xl);
		max-height: var(--3xl);
		overflow: hidden;
	}

	/* Expanded sidebar on mobile: slides up to cover full screen */
	.layout:not(.is-right-collapsed) .layout__col--right,
	.sidebar:not(.is-collapsed) {
		top: 0 !important;
		bottom: 0;
		height: 100vh;
		height: 100dvh;
		max-height: 100vh;
		max-height: 100dvh;
		/* Fallback for older Safari */
		@supports (-webkit-touch-callout: none) {
			height: -webkit-fill-available;
			max-height: -webkit-fill-available;
		}
	}

	/* Bottom bar tabs (replaces vertical sidebar tabs) */
	.sidebar-tab {
		position: relative;
		right: auto;
		top: auto;
		transform: none;
		width: 50%;
		height: var(--3xl);
		display: flex;
		align-items: center;
		justify-content: space-between;
		padding: calc(var(--base) / 4) calc(var(--base) / 2);
		background: var(--bg-black);
		border: none;
		border-top: 1px solid var(--border-color);
		font-size: var(--base);
	}

	/* Position about and guest tabs side by side */
	.sidebar-tab--about {
		border-right: 1px solid var(--border-color);
		width: 100%;
	}

	.sidebar-tab--guest {
		/* No additional positioning needed */
	}

	.sidebar-tab--guest[hidden] {
		display: none;
	}

	/* When guest is hidden, about takes full width */
	.sidebar-tab--about:only-of-type {
		width: 100%;
		border-right: none;
	}

	/* Arrow icon in tab */
	.sidebar-tab__arrow {
		width: 1rem;
		height: 1rem;
		transition: transform .25s ease;
	}

	/* Hide close button when collapsed, show arrow */
	.sidebar.is-collapsed .sidebar-tab__close {
		display: none;
	}

	.sidebar.is-collapsed .sidebar-tab__icon {
		display: flex;
	}

	/* Show close button when expanded, hide arrow */
	.sidebar:not(.is-collapsed) .sidebar-tab__close {
		display: block;
	}

	.sidebar:not(.is-collapsed) .sidebar-tab__icon {
		display: none;
	}

	/* Hide tabs when panel is open on mobile */
	.sidebar:not(.is-collapsed) .sidebar-tab {
		display: none;
	}

	/* Panel slides up from bottom - full height when open */
	.sidebar__panel {
		height: 100%;
		max-height: 100%;
		overflow-y: hidden;
		display: flex;
		flex-direction: column;
	}

	.sidebar__panel[hidden] {
		display: none !important;
	}

	/* Panel header on mobile */
	.sidebar__panel-header {
		flex-shrink: 0;
		min-height: var(--3xl);
	}

	/* Make sure close button is visible on mobile */
	.sidebar__close {
		display: block !important;
	}

	/* Sidebar content fills remaining space */
	.sidebar__content {
		flex: 1;
		overflow-y: auto;
	}

	/* Animation for mobile bottom sheet */
	@keyframes bottomSheetSlide {
		from {
			opacity: 0;
			transform: translateY(20px);
		}

		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.sidebar__panel:not([hidden]) {
		animation: bottomSheetSlide .28s ease;
	}
}