// layout/_layout.scss - 3-column adaptive layout (left / center / right)

@use '../abstracts/variables' as *;

/* Local design constants (no custom Sass functions used) */
:root {
	--border-color: rgba(255,255,255,0.12);
	--hover-bg: rgba(255,255,255,0.04);
}

.main-layout {
	height: 100vh;
	background-color: var(--bg-black);
	display: flex;
	font-size: var(--base);
	flex-direction: row;
}

/* Grid container controlling columns visibility */
.layout {
	--layout-left-width: 100%;
	--layout-right-width: auto;
	display: grid;
	height: 100%;
	width: 100%;
	grid-auto-rows: 100%;
	gap: 0;
	transition: grid-template-columns .35s ease;
	/* Default: only left column visible should be full width */
	grid-template-columns: 1fr;
}

/* Only left visible */
.layout.is-center-collapsed.is-right-collapsed {
	/* Only left visible: take 100% */
	grid-template-columns: 1fr;
}
/* Left + Right (no center) */
.layout.is-center-collapsed:not(.is-right-collapsed) {
	/* Left + Right (no center): left remains fluid, right fixed */
	grid-template-columns: 1fr var(--layout-right-width);
}
/* Left + Center */
.layout:not(.is-center-collapsed).is-right-collapsed {
	/* Left + Center: left becomes sidebar width, center fills */
	grid-template-columns: var(--layout-left-width) 1fr;
}
/* All three visible */
.layout:not(.is-center-collapsed):not(.is-right-collapsed) {
	grid-template-columns: var(--layout-left-width) 1fr var(--layout-right-width);
}

/* Right column collapsed: remove from flow but keep tab visible */
.layout.is-right-collapsed .layout__col--right {
	position: fixed;
	right: 0;
	top: 0;
	bottom: 0;
	width: 0;
	min-width: 0;
	border: none;
	background: transparent;
	overflow: visible;
	pointer-events: none;
}
.layout.is-right-collapsed .layout__col--right .sidebar-tab {
	pointer-events: auto;
}

.layout__col {
	min-width: 0;
	width: 100%;
	overflow: hidden;
	position: relative;
	display: flex;
	flex-direction: column;
	background: var(--bg-black);
	border-right: 1px solid var(--border-color);
}
.layout__col:last-child { border-right: none; }


.layout__col--center {
	border-left: 1px solid var(--border-color);
	opacity: 0;
	transition: opacity .25s ease;
}
.layout__col--center[hidden] { display: none !important; }
.layout__col--center:not([hidden]) { opacity: 1; }
.layout__col--center .message-thread { flex: 1; overflow-y: auto; padding: 1rem; }

.thread-header {
	padding: .75rem 1rem;
	border-bottom: 1px solid var(--border-color);
	display: flex;
	justify-content: flex-end;
}

/* Sidebar (right column) */
.sidebar {
	background: var(--bg-dark);
	border-left: 1px solid var(--border-color);
	display: flex;
	flex-direction: column;
	position: relative;
}
.sidebar.is-collapsed {
	/* Remove from layout flow completely; only show the floating tab */
	position: fixed;
	right: -1px;
	top: 0;
	bottom: 0;
	width: 0;
	border-left: none;
	background: transparent;
	pointer-events: none;
}
.sidebar.is-collapsed .sidebar-tab {
	pointer-events: auto;
}
.sidebar:not(.is-collapsed) { position: relative; }

.sidebar__panel {
	/* When visible, shown via [hidden] toggle; animate slide-in */
	display: flex;
	flex-direction: column;
	height: 100%;
	will-change: transform, opacity;
}
.sidebar__panel[hidden] { display: none !important; }
.sidebar__panel:not([hidden]) { animation: sidebarSlide .28s ease; }
.sidebar__content { flex: 1; overflow-y: auto; padding: 1.25rem; }

@keyframes sidebarSlide { from { opacity: 0; transform: translateX(12px); } to { opacity: 1; transform: translateX(0); } }

/* Vertical tab when collapsed */
.sidebar-tab {
	position: fixed;
	right: 0;
	top: 50%;
	transform: translateY(-50%) translateX(25%) rotate(-90deg);
	transform-origin: center;
	background: var(--bg-black);
	color: var(--text-body-light);
	border: 1px solid var(--bg-dark);
	border-bottom: none;
	padding: .5rem .75rem;
	font-weight: 600;
	letter-spacing: .05em;
	cursor: pointer;
	transition: background .2s ease;
}

/* Hide the tab when the panel is open */
.sidebar:not(.is-collapsed) .sidebar-tab { display: none; }

.icon-btn {
	background: transparent;
	border: 1px solid transparent;
	color: var(--text-body-medium);
	cursor: pointer;
	font: inherit;
	padding: .35rem .5rem;
	border-radius: .375rem;
	transition: background .15s ease, border-color .15s ease;
}
.icon-btn:hover { background: var(--hover-bg); border-color: var(--border-color); }
